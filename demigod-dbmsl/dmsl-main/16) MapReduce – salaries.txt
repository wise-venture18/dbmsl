16) MapReduce â€“ salaries

############316.Create database employee and create collection computer Define a map function to emit
the "total" key and the "Salary" value for each document. Define a reduce function to sum the
salaries associated with the "total" key. Execute the map-reduce operation on the "Computer"
collection, specifying an output collection where the results will be stored.################

--------------------------------------------------------------------------------------
use employee;
db.computer.insertMany([{ename:"a",Salary:10000},{ename:"b",Salary:15000}]);
var map=function(){ emit("total", this.Salary); };
var reduce=function(k,vals){ return Array.sum(vals); };
db.computer.mapReduce(map, reduce, {out:{replace:"salaryTotals"}});
db.salaryTotals.find();
------------------------------------------------------------------------------

ğŸ’¼ PS16 â€“ MongoDB (MapReduce â€“ Salaries)
ğŸ’¡ Aim:

Use MapReduce to calculate the total salary of all employees in the computer collection.

âœ… Step-by-Step Code with Explanation
ğŸ§© Step 1 â€” Create / Use database
use employee;


ğŸ‘‰ Switches to (or creates) a database named employee.

ğŸ§© Step 2 â€” Insert records into computer collection
db.computer.insertMany([
  {ename:"a", Salary:10000},
  {ename:"b", Salary:15000}
]);

ğŸ” Explanation:

Creates a collection named computer.

Inserts two employee documents:

Employee a â†’ Salary 10,000

Employee b â†’ Salary 15,000

âœ… Resulting Data:

[
  {ename:"a", Salary:10000},
  {ename:"b", Salary:15000}
]

ğŸ§© Step 3 â€” Define the Map function
var map = function() { emit("total", this.Salary); };

ğŸ” Explanation:

The map function runs once per document.

emit(key, value) â†’ emits key-value pairs.

Here, the key is "total" (same for all records) and the value is each employeeâ€™s Salary.

So after map phase:

emit("total", 10000)
emit("total", 15000)

ğŸ§© Step 4 â€” Define the Reduce function
var reduce = function(k, vals) { return Array.sum(vals); };

ğŸ” Explanation:

The reduce function takes:

k â†’ key (in this case "total")

vals â†’ array of all emitted salary values

Array.sum(vals) â†’ adds all salary values.

So after reduce phase:

total = 10000 + 15000 = 25000

ğŸ§© Step 5 â€” Execute MapReduce
db.computer.mapReduce(map, reduce, { out: { replace: "salaryTotals" } });

ğŸ” Explanation:

Executes the MapReduce process:

map â†’ emits salaries.

reduce â†’ sums them.

{ out: { replace: "salaryTotals" } } â†’ saves output in a new collection named salaryTotals.

âœ… Output message:

{
  "result" : "salaryTotals",
  "timeMillis" : 15,
  "counts" : { "input" : 2, "emit" : 2, "reduce" : 1, "output" : 1 },
  "ok" : 1
}


âœ… It means:

2 input documents

2 emitted values

1 reduce operation

1 output document created

ğŸ§© Step 6 â€” View the results
db.salaryTotals.find();


âœ… Output:

[
  { "_id": "total", "value": 25000 }
]


âœ… This means total salary of all employees = 25,000

ğŸ§  Concept Explanation
ğŸ§© What is MapReduce?

MapReduce = a two-phase process used for summarizing or processing large datasets.

Phase	Function	Description
Map	emit(key, value)	Maps each document to a key-value pair.
Reduce	Array.sum(values)	Combines all values having the same key.

Analogy (SQL equivalent):

SELECT SUM(Salary) AS total FROM computer;


MongoDB does the same using JavaScript functions.

ğŸ§© Why Use MapReduce?

When you need custom aggregation logic (like complex calculations).

Used for large-scale datasets or parallel data processing.

Can perform multiple aggregations (sum, avg, min, max, etc.) in one pass.

ğŸ§© What is emit()?

The core function of the Map phase.

Syntax: emit(key, value)

Sends key-value pairs to the Reduce phase.

ğŸ§© What is Array.sum()?

A built-in MongoDB function used inside reduce.

Adds up all numeric values in an array.

Example:

Array.sum([10000,15000]) â†’ 25000

ğŸ§© What does {out:{replace:"salaryTotals"}} mean?

Specifies the output collection.

The result of MapReduce will be stored in a collection named salaryTotals.

If the collection already exists, it will replace it.

ğŸ§¾ Viva Questions & Answers
Question	                                                        Answer
What is MapReduce in MongoDB?                          	Itâ€™s a framework to process and summarize data using Map and Reduce functions.
What does emit() do?	                        Emits key-value pairs to be processed in the Reduce phase.
What is Array.sum() used for?	                      To sum up numeric values in the Reduce function.
What are the phases in MapReduce?	                        Map Phase and Reduce Phase.
What does {out:{replace:"salaryTotals"}} mean?	                                It stores the MapReduce output in a new collection called salaryTotals.
What is the output of this program?                                	{ "_id": "total", "value": 25000 } â†’ total salary = 25000.
Difference between MapReduce and Aggregation?	                    Aggregation uses pipeline operators; MapReduce uses custom JS functions for flexibility.
