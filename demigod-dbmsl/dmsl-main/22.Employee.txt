#############22.Employee(employee_name,street,city)
Works(employee_name,company_name,salary)
Company(company_name,city)
Manages(employee_name,manager_name)
1) Find all employees in the database who earn more than each employee of Small Bank
Coorporation
2) Assume that the company is may be located in several cities. Find all companies located
in every city in which Small Bank Coorporation is located.
3) Find all employees who earn more than the average salary of all employees of their
companies.
4) Find the company that has the most employees.
5) Find the company that has the smallest payroll.
6) Find those companies whose employees earn a higher salary, on average, than the
average salary at First Bank Coorporation.
7) Modify the database so that “Jones” now lives in Newtown.################


==============================================22=======================================================
-- Create & use a fresh DB
CREATE DATABASE IF NOT EXISTS CorpDB22;
USE CorpDB22;

-- Clean slate
DROP TABLE IF EXISTS Manages;
DROP TABLE IF EXISTS Works;
DROP TABLE IF EXISTS Company;
DROP TABLE IF EXISTS Employee;

-- Schema
CREATE TABLE Employee(
  employee_name VARCHAR(50) PRIMARY KEY,
  street        VARCHAR(50),
  city          VARCHAR(40)
);

CREATE TABLE Company(
  company_name  VARCHAR(60),
  city          VARCHAR(40),
  PRIMARY KEY (company_name, city)     -- a company can be in several cities
);

CREATE TABLE Works(
  employee_name VARCHAR(50),
  company_name  VARCHAR(60),
  salary        DECIMAL(10,2),
  FOREIGN KEY (employee_name) REFERENCES Employee(employee_name),
  FOREIGN KEY (company_name)  REFERENCES Company(company_name)
);

CREATE TABLE Manages(
  employee_name VARCHAR(50),
  manager_name  VARCHAR(50)
);

-- Sample data (tuned for the questions)
INSERT INTO Employee VALUES
('Neha','MG Road','Pune'),
('Ravi','FC Road','Pune'),
('Priya','Hill Rd','Mumbai'),
('Amit','Linking Rd','Mumbai'),
('Sonal','Main St','Delhi'),
('Vikas','JM Road','Pune'),
('Reena','MG Road','Delhi'),
('Jones','Park Ave','Oldtown');

-- Companies (note: Small Bank is in multiple cities)
INSERT INTO Company VALUES
('First Bank Corporation','Pune'),
('First Bank Corporation','Mumbai'),
('Small Bank Corporation','Delhi'),
('Small Bank Corporation','Pune'),
('National Bank','Pune'),
('National Bank','Delhi'),
('FinTech Ltd','Pune'),
('FinTech Ltd','Delhi'),
('IT Hub Ltd','Pune');

-- Works
INSERT INTO Works VALUES
('Neha','First Bank Corporation',12000),
('Amit','First Bank Corporation',11000),
('Ravi','National Bank',13000),
('Priya','Small Bank Corporation',9000),
('Vikas','Small Bank Corporation',14000),
('Sonal','FinTech Ltd',16000),
('Reena','National Bank',8000),
('Jones','IT Hub Ltd',10000);

-- Managers (not used directly in these Qs, but kept per spec)
INSERT INTO Manages VALUES
('Neha','Priya'),
('Ravi','Amit'),
('Sonal','Vikas'),
('Amit','Priya'),
('Vikas','Reena');

/* ================================
   QUERIES (1) … (7)
   ================================ */

-- 1) Employees who earn more than EACH employee of Small Bank Corporation
SELECT w.employee_name
FROM Works w
WHERE w.salary > ALL (
  SELECT salary
  FROM Works
  WHERE company_name = 'Small Bank Corporation'
);

-- 2) Companies located in EVERY city where Small Bank Corporation is located
-- (relational division using double NOT EXISTS)
SELECT DISTINCT c1.company_name
FROM Company c1
WHERE NOT EXISTS (
  SELECT 1
  FROM Company sb
  WHERE sb.company_name = 'Small Bank Corporation'
    AND NOT EXISTS (
      SELECT 1
      FROM Company c2
      WHERE c2.company_name = c1.company_name
        AND c2.city = sb.city
    )
);

-- 3) Employees who earn more than the AVERAGE salary of their company
SELECT w.employee_name, w.company_name, w.salary
FROM Works w
WHERE w.salary > (
  SELECT AVG(w2.salary)
  FROM Works w2
  WHERE w2.company_name = w.company_name
);

-- 4) Company with the MOST employees (ties shown if you prefer ORDER BY … LIMIT 1)
SELECT company_name, COUNT(*) AS emp_count
FROM Works
GROUP BY company_name
ORDER BY emp_count DESC
LIMIT 1;

-- 5) Company with the SMALLEST payroll (sum of salaries)
SELECT company_name, SUM(salary) AS payroll
FROM Works
GROUP BY company_name
ORDER BY payroll ASC
LIMIT 1;

-- 6) Companies whose AVG salary > AVG salary at First Bank Corporation
SELECT w.company_name, AVG(w.salary) AS avg_sal
FROM Works w
GROUP BY w.company_name
HAVING AVG(w.salary) >
       (SELECT AVG(salary) FROM Works WHERE company_name='First Bank Corporation');

-- 7) Modify database so that “Jones” now lives in Newtown
UPDATE Employee
SET city = 'Newtown'
WHERE employee_name = 'Jones';

-- Quick check
SELECT * FROM Employee WHERE employee_name='Jones';
