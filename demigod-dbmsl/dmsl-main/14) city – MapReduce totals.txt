14) city â€“ MapReduce totals

##############14.Collection â€œcity â€œ which contains the documents given as below(Perform on Mongo
Terminal)
{
city:â€puneâ€,
type:â€urbanâ€,
state:â€MHâ€,
population:â€5600000â€
}
-using mapreduce, find statewise population
-using mapreduce, find citywise population
-using mapreduce, find typewise population. ###################3


-----------------------------------------------------------------------------------------------------------------------

use test;
db.createCollection("city");
db.city.insertMany([
 {city:"pune",type:"urban",state:"MH",population:5600000},
 {city:"nagpur",type:"urban",state:"MH",population:2400000},
 {city:"nashik",type:"urban",state:"MH",population:1700000}
]);
var reduceSum=(k,vals)=>Array.sum(vals);
db.city.mapReduce(function(){emit(this.state,this.population);}, reduceSum, {out:"statePop"});
db.city.mapReduce(function(){emit(this.city, this.population);}, reduceSum, {out:"cityPop"});
db.city.mapReduce(function(){emit(this.type, this.population);}, reduceSum, {out:"typePop"});
db.statePop.find(); 
db.cityPop.find(); 
db.typePop.find();
--------------------------------------------------------------------------------------------------------


ðŸŒ† PS14 â€“ MongoDB (City: MapReduce Totals)
ðŸ’¡ Aim:

Use MapReduce to find total populations based on state, city, and type.

âœ… Step-by-Step Code with Explanation
ðŸ§© Step 1 â€” Create / use database and insert records
db.city.insertMany([
  {city:"pune", type:"urban", state:"MH", population:5600000},
  {city:"nagpur", type:"urban", state:"MH", population:2400000},
  {city:"nashik", type:"urban", state:"MH", population:1700000}
]);

ðŸ” Explanation:

Creates a collection named city and inserts 3 documents.

Each record represents a city in the state Maharashtra (MH) with:

city: name of the city

type: urban/rural

state: state name/code

population: total population

âœ… Resulting Data:

[
  {city:"pune", type:"urban", state:"MH", population:5600000},
  {city:"nagpur", type:"urban", state:"MH", population:2400000},
  {city:"nashik", type:"urban", state:"MH", population:1700000}
]

ðŸ§© Step 2 â€” Define the Reduce function
var reduceSum = (key, values) => Array.sum(values);

ðŸ” Explanation:

This defines a reduce function named reduceSum.

Parameters:

key â†’ grouping key (like state/city/type)

values â†’ array of all population values for that key

Array.sum(values) â†’ adds up all the population numbers in that group.

âœ… Purpose: To calculate total population per key.

ðŸ§© Step 3 â€” MapReduce by state
db.city.mapReduce(
  function() { emit(this.state, this.population); },
  reduceSum,
  { out: "statePop" }
);

ðŸ” Explanation:

Map function: emit(this.state, this.population);
â†’ Emits state as key and population as value for each document.

Reduce function: reduceSum (defined above)
â†’ Sums all population values grouped by state.

Output: Results stored in a new collection statePop.

âœ… Output Collection (statePop):

[
  { _id: "MH", value: 9700000 }
]


â†’ Total population of all cities in Maharashtra = 9,700,000.

ðŸ§© Step 4 â€” MapReduce by city
db.city.mapReduce(
  function() { emit(this.city, this.population); },
  reduceSum,
  { out: "cityPop" }
);

ðŸ” Explanation:

Groups by city.

Emits each city and its population (basically just re-listing each cityâ€™s population).

âœ… Output Collection (cityPop):

[
  { _id: "pune", value: 5600000 },
  { _id: "nagpur", value: 2400000 },
  { _id: "nashik", value: 1700000 }
]

ðŸ§© Step 5 â€” MapReduce by type
db.city.mapReduce(
  function() { emit(this.type, this.population); },
  reduceSum,
  { out: "typePop" }
);

ðŸ” Explanation:

Groups all cities by their type (urban/rural).

Calculates total population by type.

âœ… Output Collection (typePop):

[
  { _id: "urban", value: 9700000 }
]


â†’ Total population of all urban cities = 9.7 million.

ðŸ§© Step 6 â€” View the results
db.statePop.find();
db.cityPop.find();
db.typePop.find();


âœ… Outputs:

> db.statePop.find()
[ { _id: "MH", value: 9700000 } ]

> db.cityPop.find()
[
  { _id: "pune", value: 5600000 },
  { _id: "nagpur", value: 2400000 },
  { _id: "nashik", value: 1700000 }
]

> db.typePop.find()
[ { _id: "urban", value: 9700000 } ]

ðŸ§  Concept Explanation
ðŸ§© What is MapReduce?

Definition:
MapReduce is a data processing model in MongoDB used to perform complex aggregation or summarization tasks in two stages:

Map phase â†’ emits key-value pairs for each document.

Reduce phase â†’ combines values with the same key using a function (e.g., sum, avg).

Analogy:
Like SQL:

SELECT state, SUM(population)
FROM city
GROUP BY state;


MongoDB equivalent:

map = function() { emit(this.state, this.population); }
reduce = function(key, values) { return Array.sum(values); }
db.city.mapReduce(map, reduce, {out: "statePop"});

ðŸ§© Why use MapReduce?

When you need custom aggregation logic beyond $group or $sum.

Itâ€™s programmable (you can use JS functions).

Good for large datasets (distributed processing).

ðŸ§© What is Indexing?

Index:
A special data structure that improves query speed â€” similar to an index in a book.
When you query MongoDB (like searching for a city), the index allows it to find the record quickly without scanning the entire collection.

Creating index example:

db.city.createIndex({ city: 1 });


Why we use indexing:

Benefit	Explanation
Faster search	MongoDB can directly jump to the record
Faster sorting	Improves $sort operations
Better performance	Especially for large datasets

Drawbacks:

Uses extra memory

Slower inserts/updates (since index must be updated too)

ðŸ§¾ Viva Questions & Answers
Question                                                                           	Answer
What is the purpose of MapReduce?	                           To perform aggregation or summarization of large data using custom map and reduce functions.
What does emit() do in MapReduce?	                             It emits a key-value pair (key = group field, value = data to be aggregated).
What does Array.sum(values) do?	                                    Sums up all numeric values for the same key during reduction.
What is the output of MapReduce stored in?                           	A new collection specified by the out parameter.
Difference between Aggregation and MapReduce?	Aggregation uses built-in pipeline operators; MapReduce allows custom JS logic.
Why do we use Indexing?	To make searching and sorting operations faster.
Syntax to create index?	db.collection.createIndex({ field: 1 })
Syntax to remove index?	db.collection.dropIndex({ field: 1 })
